<div class="jumbotron jumbotron-fluid">
  <button *ngIf="currentUser" type="button" class="btn btn-outline-danger float-right" (click)="logout()">Logout</button>

  <div class="container">
    <h1 class="display-4">Welcome, {{ currentUser?.username }}!</h1>
    <h3 class="lead">This is a simple real-time food ordering application.</h3>
    <p>This app helps your colleagues make their order, and most importantly it also displays everyone's money share.</p>
    <hr>
    <p>Few tips:</p>
    <ul>
      <li>Increment the quantity of already existing items, do not create duplicates.</li>
      <li>This is a very simple, two-days-development, and super-easy to break App. So please don't break it.
        (That won't make you a hacker, just an annoying person with no friends)</li>
    </ul>
    <hr class="my-4">
    <p>Please report bugs/suggestion to the <a href="https://github.com/aldokkani/food"> <strong>GitHub</strong></a>
      Repo</p>
  </div>
</div>
<div class="container">

  <ng-template #deleteTemplate>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Delete Order</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="alert alert-danger" role="alert">
        Are you really sure? You cannot undo this action, George might eat you alive if he's hungery and you are
        cancelling
        the order!
      </div>
      <button type="button" class="btn btn-danger btn-sm btn-block" (click)="deleteOrder(); modalRef.hide()">Let George
        kills me!</button>
    </div>
  </ng-template>

  <ng-template #mathTemplate>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Check</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="alert alert-warning" role="alert">
        Make sure that you update the price for all order's items & the delivery fees.
      </div>
      <ul class="list-group">
        <div *ngIf="!Object.keys(result).length" class="d-flex align-items-center">
          <strong>Doing math...</strong>
          <div class="spinner-border ml-auto text-primary" role="status" aria-hidden="true"></div>
        </div>
        <li *ngFor="let person of result | keyvalue" class="list-group-item d-flex justify-content-between align-items-center">
          {{ person.key }}
          <span class="badge badge-primary badge-pill">{{ person.value | currency }}</span>
        </li>
      </ul>
    </div>
  </ng-template>

  <ng-template #template>
    <div class="modal-body">
      <div class="form-row">
        <div class="col-md-9">
          <input #username type="text" class="form-control" placeholder="Enter your name">
        </div>
        <div class="col-md-3">
          <button type="button" class="btn btn-primary" (click)="signIn(username.value)">Start order</button>
        </div>
      </div>
    </div>
  </ng-template>

  <div *ngIf="currentUser">
    <button type="button" class="btn btn-primary btn-lg btn-block" (click)="doMath(); openModal(mathTemplate)">Get
      Check</button>
    <button type="button" class="btn btn-danger btn-lg btn-block" (click)="openModal(deleteTemplate)">Delete Order</button>
    <br>

    <form class="form-inline" [formGroup]="orderItemForm" (ngSubmit)="onSubmit()">
      <label class="sr-only" for="inlineFormInputName1">Item</label>
      <input type="text" class="form-control mb-2 mr-sm-2" id="inlineFormInputName1" placeholder="Item Name i.e. Btngan*"
        formControlName="item" required>

      <label class="sr-only" for="inlineFormInputName2">Quantity</label>
      <input type="number" class="form-control mb-2 mr-sm-2" id="inlineFormInputName2" placeholder="Quantity*"
        formControlName="quantity">

      <button type="submit" class="btn btn-primary mb-2">Add to Order</button>
    </form>

    <h3>Main Order</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Item</th>
          <th scope="col">Item Price (Unit Price)</th>
          <th scope="col">Quantity</th>
          <th scope="col">Owners</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of order | keyvalue; let i = index">
          <th scope="row">{{i + 1}}</th>
          <td>{{ item.value.item }}</td>
          <td>
            <div class="input-group mb-3">
              <input class="form-control" type="number" [value]="item.value.price || 0" (blur)="onPrice($event, item.key)">
              <div class="input-group-append">
                <span class="input-group-text">$</span>
              </div>
            </div>
          </td>
          <td><input class="form-control" type="number" [value]="item.value.quantity" (blur)="onChange($event, item.key, item.value.quantity)"></td>
          <td>{{ getOwners(item.value.owners) | json }}</td>
        </tr>
        <tr>
          <th scope="row">#</th>
          <td colspan="2"><input #feesRef (blur)="fees = feesRef.value" class="form-control" type="number" placeholder="Insert here taxes/service/delivery fees."></td>
        </tr>
      </tbody>
    </table>

    <h3>Your Order</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Item</th>
          <th scope="col">Quantity</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of myOrder | keyvalue; let i = index">
          <th scope="row">{{i + 1}}</th>
          <td>{{ item.value.item }}</td>
          <td><input class="form-control" type="number" [value]="getOwnQuantity(item.key)" (blur)="onChange($event, item.key, item.value.quantity)"></td>
          <td><button (click)="deleteItem(item.key)" class="btn btn-danger">Delete</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
